<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảo Tàng Sài Gòn</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="./assets/fonts/themify-icons/themify-icons.css">
</head>
<body>
    <div id="main">
        <div id="header">
            <ul id="nav">
                <li><a href="#">baotangsaigon.com</a></li>
                <li>
                    <a href="#">Khám phá & Review bảo tàng</a>
                    <ul class="subnav">
                        <li><a href="#">bt1</a></li>
                        <li><a href="#">bt2</a></li>
                        <li><a href="#">bt3</a></li>
                    </ul>
                </li>
                <li><a href="/login">Đăng ký/Đăng nhập</a></li>
            </ul>
        </div>

        <div id="content">
            <div id="main-content">
                <div class="section">
                    <h2 class="section-title">Đánh giá & Review</h2>
                    <div id="review-list"></div>
                    <h4>Viết đánh giá của bạn</h4>
                    <div id="star-rating"></div>
                    <textarea id="comment" placeholder="Nhập đánh giá..."></textarea>
                    <button id="submit-review">Gửi đánh giá</button>
                </div>

                <div class="section">
                    <h2 class="section-title">Bình luận</h2>
                    <div id="comment-list"></div>
                    <textarea id="new-comment" placeholder="Nhập bình luận..."></textarea>
                    <button id="submit-comment">Gửi bình luận</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const museumName = "BẢO TÀNG THÀNH PHỐ HỒ CHÍ MINH";
            async function loadReviews() {
                const response = await fetch(`/reviews/${museumName}`);
                const data = await response.json();
                document.getElementById("review-list").innerHTML = data.map(r => `<p><strong>${r.username}</strong> (${r.rating}★): ${r.comment}</p>`).join("");
            }
            loadReviews();

            async function loadComments() {
                const response = await fetch(`/comments/${museumName}`);
                const data = await response.json();
                document.getElementById("comment-list").innerHTML = data.map(c => `<p><strong>${c.username}</strong>: ${c.comment} <small>(${c.timestamp})</small></p>`).join("");
            }
            loadComments();

            document.getElementById("submit-review").addEventListener("click", async function() {
                let comment = document.getElementById("comment").value;
                let rating = 5;
                const response = await fetch("/reviews", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ museum_name: museumName, rating, comment })
                });
                alert((await response.json()).message);
                loadReviews();
            });

            document.getElementById("submit-comment").addEventListener("click", async function() {
                let comment = document.getElementById("new-comment").value;
                const response = await fetch("/comments", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ museum_name: museumName, comment })
                });
                alert((await response.json()).message);
                loadComments();
            });
        });
    </script>
</body>
</html>